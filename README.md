# POG: Proportionality-driven Occlusion Grid
This code is part of the Thesis Project of Attila Herbert, a student of Maastricht University.
It includes the implementation of the methods proposed in the paper along some models and 
datasets for testing, and an implementation of Grid Saliency 
[1](https://arxiv.org/abs/1907.13054). 

## Datasets

### Biased dataset from Grid Saliency
This repository includes some files from Grid Saliency [1](https://arxiv.org/abs/1907.13054) 
under the biased_dataset folder. This dataset was used for testing in the early phases.

### PASCAL-VOC 
This repository uses data from the PASCAL-VOC dataset. Only segmentation images with landscape
orientation are used.

### Cityscapes
This repository uses data from the Cityscapes dataset with the help of Tensorflow Datasets.

## Models

### U-Net
We include an adaptation of the U-Net model from Segmentation Models to our framework. 
This model contains a loading function that loads data from a directory named `unetmodel`. 
The loading function of Keras is utilized, so the directory format of Keras is expected. 
The U-Net model was used in the early phases of testing.

### DeepLabv3+
We include an implementation of a frozen graph loader (credit to Neurocat developers). Using
this model loader, we loaded the DeepLabv3+ model. This model was used in the main testing
phase on an AWS EC2 instance. 

## Explanations

### General usage
The explanations have to follow the interface description in `explanation.py`. All explanations
can be used via their function `get_explanation()`.

### Grid Saliency
We implemented the Grid Saliency explanation method according to the paper 
[1](https://arxiv.org/abs/1907.13054), however, since some implementation details were missing,
we do not claim that this implementation is equivalent to that of Hoyer et al. We experimented
with several optimizers, which are included in this repository. Some of these optimizers were
not used in testing.

### Integrated Gradients for Semantic Segmentation
We include an implementation of Integrated Gradients for semantic segmentation context 
explanations. This implementation is very simple and was not used in the final testing phase
because of issues with Tensorflow frozen graphs and gradient calculation.

### POG: Proportionality-based Occlusion Grid
The implementation of our proposed methods are included as well. Both sufficiency and 
necessity variants are implemented. 

## Evaluations

### Proportionality
We implemented two evaluations, sufficiency and necessity proportionality. These evaluations
reside in the `evaluations.py` file.

## Pipeline

We set up a testing pipeline in `main.py`. This pipeline can be configured in the
`pipeline_config.py`. The pipeline consists of a dataset, a list of models to be tested,
a list of baselines to try, a list of explanations to test and a list of evaluations to run 
for each saliency map generated by the explanation methods. This pipeline creates a .pkl file 
that stores all saliency maps and their evaluations. 

The pipeline can be seeded to allow reproduction. This seed is also included in the .pkl file. 

## Visualizations

`presenter.py` includes several visualizations that we show in the thesis report.

